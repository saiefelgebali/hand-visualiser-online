var e=Object.defineProperty,t=(t,s,n)=>(((t,s,n)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n})(t,"symbol"!=typeof s?s+"":s,n),n);import{c as s,t as n,d as o,u as r,o as i,a,i as c,b as h,L as l,e as d,D as u,V as m,f as g,H as p,g as v,G as f,M as _,B as w,S as b,P as y,W as $,O as S,C,F as N,h as k,j as z,k as x,l as j,s as L,m as P,n as M,p as I,E as H,R as E,q as O,r as T,v as J}from"./vendor.f9350cce.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var R=new class{constructor(){t(this,"parseKey",(e=>`client-${e}`)),t(this,"set",((e,t)=>{let s="";if("string"==typeof t&&(s=t),"number"==typeof t?s=t.toString():"object"==typeof t&&(s=JSON.stringify(t)),s)return localStorage.setItem(this.parseKey(e),s);throw console.error(`localStorage: could not set item with key ${e} to`,t)})),t(this,"get",(e=>localStorage.getItem(this.parseKey(e))||void 0))}};const[U,F]=s(R.get("username")),[D,W]=s(),[B,A]=s(),[K,q]=s([]),[G,V]=s([]),[X,Y]=s();var Q="_home_1hzuk_1",Z="_joinRoomForm_1hzuk_8",ee="_submit_1hzuk_21",te="_disabled_1hzuk_40";const se=n("<button>Join Room</button>"),ne=n('<div><form><input type="text" name="username" placeholder="Username" maxlength="20" autocomplete="off"><input type="text" name="roomId" placeholder="Room ID" maxlength="8" autocomplete="off"></form></div>');function oe(e){const t=e.currentTarget;F(t.value)}function re(e){const t=e.currentTarget;W(t.value)}function ie(e){}const ae=()=>{const[e,t]=s(),n=r();return i((()=>{n("/home")})),a((()=>{const e=!(!U()||!D());t(e)})),(()=>{const t=ne.cloneNode(!0),s=t.firstChild,n=s.firstChild,o=n.nextSibling;return s.addEventListener("submit",ie),n.$$input=oe,o.$$input=re,c(s,h(l,{get href(){return`/room/${D()}`},get classList(){return{[ee]:!0,[te]:!e()}},get children(){return se.cloneNode(!0)}}),null),d((e=>{const r=Q,i=Z,a=U(),c=D();return r!==e._v$&&(t.className=e._v$=r),i!==e._v$2&&(s.className=e._v$2=i),a!==e._v$3&&(n.value=e._v$3=a),c!==e._v$4&&(o.value=e._v$4=c),e}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),t})()};o(["input"]);const ce=`ws://${globalThis.SERVER}`;class he{constructor(e){t(this,"scene"),t(this,"object"),this.scene=e}addToScene(){if(this.object)return this.scene.add(this.object),this}removeFromScene(){if(this.object)return console.log("removed object from scene:",this.object.name||this.object.type),this.scene.remove(this.object),this}}class le extends he{constructor(e){return super(e),t(this,"helper"),this}setup(e={}){const{position:t={x:0,y:0,z:0},intensity:s=1,castShadows:n=!1,shadowCamFrustum:o=1.5}=e,r=new u(16777215,s);if(r.position.set(t.x,t.y,t.z),n){r.castShadow=n,r.shadow.mapSize=new m(1024,1024);const e=o;r.shadow.camera.left=-e,r.shadow.camera.right=e,r.shadow.camera.top=e,r.shadow.camera.bottom=-e}return this.object=r,this}debug(){this.helper=new g(this.object,1,4521864),this.scene.add(this.helper)}}class de extends he{constructor(e){return super(e),t(this,"helper"),this}setup(e={}){const{intensity:t=1,position:s={x:0,y:0,z:0}}=e,n=new p(16777215,16777215,t);return n.position.set(s.x,s.y,s.z),this.object=n,this}debug(){this.helper=new v(this.object,1,4521864),this.scene.add(this.helper)}}class ue extends he{constructor(e){super(e),t(this,"gltfLoader",new f),t(this,"hand",{thumb:[],index:[],middle:[],ring:[],pinky:[]}),t(this,"setup",(async()=>{const e=(await this.gltfLoader.loadAsync("/models/hand_r.glb")).scene;return e.traverse((e=>{e instanceof _&&(e.castShadow=!0,e.receiveShadow=!0),e instanceof w&&this.mapBoneToHand(e)})),e.scale.set(7,7,7),this.object=e,this})),t(this,"mapBoneToHand",(e=>{const t=e.name.match(/thumb|index|middle|ring|pinky/gm);if(!t)return;const s=t[0];this.hand[s].push(e)})),t(this,"update",(()=>{this.object})),t(this,"setHandPosition",(e=>{for(const t in e)this.bendFinger(t,e[t])}))}bendFinger(e,t){const s=this.hand[e],n=-t/100;"thumb"!=e?(s[0].rotation.x=n*(.5*Math.PI),s[1].rotation.x=n*(.5*Math.PI)):s[2].rotation.z=n*(.4*Math.PI)}}var me="_UIMessage_1546d_1";const ge=n("<div></div>"),pe=({message:e})=>(()=>{const t=ge.cloneNode(!0);return c(t,e),d((()=>t.className=me)),t})();var ve="_chatPanel_twc0z_1",fe="_roomPanel_twc0z_2",_e="_controlsPanel_twc0z_3",we="_title_twc0z_31",be="_roomID_twc0z_32",ye="_userList_twc0z_35",$e="_username_twc0z_46",Se="_inputGroup_twc0z_58",Ce="_chatBox_twc0z_75",Ne="_message_twc0z_86",ke="_info_twc0z_96";const ze=n("<div></div>"),xe=n("<span></span>"),je=n("<div><span></span></div>"),Le=n('<form><input type="text" name="message" autocomplete="off"><button>Send</button></form>'),Pe=()=>(()=>{const e=ze.cloneNode(!0);return c(e,h(Me,{}),null),c(e,h(He,{}),null),d((()=>e.className=ve)),e})(),Me=()=>{let e;return a((()=>{G()&&(e.scrollTop=e.scrollHeight)})),(()=>{const t=ze.cloneNode(!0);return"function"==typeof e?e(t):e=t,c(t,h(x,{get each(){return G()},children:e=>h(Ie,{message:e})})),d((()=>t.className=Ce)),t})()},Ie=({message:e})=>{const t=()=>e.user?(()=>{const t=xe.cloneNode(!0);return c(t,(()=>e.user.username)),d((()=>t.className=$e)),t})():null;return(()=>{const s=je.cloneNode(!0),n=s.firstChild;return c(s,h(t,{}),n),c(n,(()=>e.message)),d((t=>{const o={[Ne]:!0,[ke]:e.info},r=Ne;return t._v$=j(s,o,t._v$),r!==t._v$2&&(n.className=t._v$2=r),t}),{_v$:void 0,_v$2:void 0}),s})()},He=()=>{function e(e){e.preventDefault();const t=e.target,s=new FormData(t).get("message");B().controller.sendChatMessage(s),t.reset()}return(()=>{const t=Le.cloneNode(!0);return t.addEventListener("submit",e),t})()},Ee=n("<div><div>Controls</div></div>"),Oe=n('<div><label></label><input type="range" value="0"></div>'),Te=["thumb","index","middle","ring","pinky"],Je=()=>(()=>{const e=Ee.cloneNode(!0),t=e.firstChild;return c(e,h(x,{each:Te,children:e=>h(Re,{fingerName:e})}),null),d((s=>{const n=_e,o=we;return n!==s._v$&&(e.className=s._v$=n),o!==s._v$2&&(t.className=s._v$2=o),s}),{_v$:void 0,_v$2:void 0}),e})(),Re=({fingerName:e})=>{function t(e){const t=e.target,s=t.name,n=t.valueAsNumber;Y((e=>({...e,[s]:n}))),B().controller.sendHandPosition(X())}return(()=>{const s=Oe.cloneNode(!0),n=s.firstChild,o=n.nextSibling;return L(n,"for",e),c(n,(()=>e.toUpperCase())),o.$$input=t,L(o,"name",e),d((()=>s.className=Se)),s})()};o(["input"]);const Ue=n("<div></div>"),Fe=n("<div><div>Room ID: </div><div>Users (<!>)</div><div></div></div>"),De=({user:e})=>(()=>{const t=Ue.cloneNode(!0);return c(t,(()=>e.username)),d((()=>t.className=$e)),t})(),We=()=>(()=>{const e=Fe.cloneNode(!0),t=e.firstChild;t.firstChild;const s=t.nextSibling,n=s.firstChild.nextSibling;n.nextSibling;const o=s.nextSibling;return c(t,D,null),c(s,(()=>K().length),n),c(o,h(x,{get each(){return K()},children:e=>h(De,{user:e})})),d((n=>{const r=fe,i=be,a=we,c=ye;return r!==n._v$&&(e.className=n._v$=r),i!==n._v$2&&(t.className=n._v$2=i),a!==n._v$3&&(s.className=n._v$3=a),c!==n._v$4&&(o.className=n._v$4=c),n}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),e})(),[Be]=s(new class{constructor(){t(this,"scene",new b),t(this,"camera"),t(this,"renderer"),t(this,"controls"),t(this,"handController"),t(this,"hemiLightController"),t(this,"dirLightController"),t(this,"start",(()=>{this.update()})),t(this,"setup",(async e=>{this.setSize(),this.renderer.shadowMap.enabled=!0,this.camera.position.z=-1,this.camera.position.y=1.5,this.camera.position.x=2,this.scene.background=new C(16777215),this.scene.fog=new N(16777215,.1,200);const t=new _(new k(2e3,2e3,1,1),new z({color:15658734,shininess:0}));t.rotateX(-.5*Math.PI),t.receiveShadow=!0,t.position.y=-1,this.scene.add(t),this.hemiLightController.setup({position:{x:0,y:1,z:0},intensity:.6}),this.hemiLightController.addToScene(),this.dirLightController.setup({position:{x:0,y:1,z:1},intensity:.5,castShadows:!0}),this.dirLightController.addToScene(),await this.handController.setup(),this.handController.addToScene(),window.addEventListener("resize",(()=>{this.setSize(),this.render()})),e&&e()})),t(this,"update",(()=>{requestAnimationFrame(this.update),this.controls.update(),this.handController.update(),this.render()})),t(this,"render",(()=>{this.renderer.render(this.scene,this.camera)})),t(this,"setSize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)})),t(this,"setHandPosition",(e=>{this.handController.setHandPosition(e)})),this.camera=new y(50,window.innerWidth/window.innerHeight),this.renderer=new $({antialias:!0}),this.controls=new S(this.camera,this.renderer.domElement),this.hemiLightController=new de(this.scene),this.dirLightController=new le(this.scene),this.handController=new ue(this.scene)}getCanvas(){return this.renderer.domElement}}),[Ae,Ke]=s(),[qe,Ge]=s("Loading client..."),Ve=({offline:e})=>{a((()=>{X()&&Be().setHandPosition(X())})),i((async()=>{Ae()||(await Be().setup(),Be().start(),Ke(Be().getCanvas()),Ge(null))}));const t=()=>[h(We,{}),h(Pe,{})],s=()=>[!e&&h(t,{}),h(Je,{}),P(Ae)];return(()=>{const e=P((()=>!!qe()),!0);return()=>e()?h(pe,{get message(){return qe()}}):h(s,{})})()},Xe=()=>h(Ve,{offline:!0});class Ye{constructor(e){t(this,"socket"),t(this,"sendChatMessage",(e=>{const t={type:"chatMessage",message:e};this.socket.emit(t)})),t(this,"sendHandPosition",(e=>{const t={type:"handPosition",hand:e};this.socket.emit(t)})),t(this,"onSocketOpen",(()=>{const e={type:"connect",roomId:D(),username:U()};this.socket.emit(e)})),t(this,"onSocketClose",(()=>{})),t(this,"onSocketMessage",(e=>{switch(e.type){case"joinRoom":return this.handleJoinRoom(e);case"userJoined":return this.handleUserJoined(e);case"userLeft":return this.handleUserLeft(e);case"chatMessage":return this.handleChatMessage(e);case"handPosition":return this.handleHandPosition(e)}})),t(this,"handleJoinRoom",(e=>{q(e.room.users);const t={message:"You joined the lobby!",info:!0};V((e=>[...e,t]))})),t(this,"handleUserJoined",(e=>{q((t=>[...t,e.user]));const t={message:`${e.user.username} joined the lobby!`,info:!0};V((e=>[...e,t]))})),t(this,"handleUserLeft",(e=>{q((t=>t.filter((t=>t.userId!==e.user.userId))));const t={message:`${e.user.username} left the lobby.`,info:!0};V((e=>[...e,t]))})),t(this,"handleChatMessage",(e=>{const t={user:e.user,message:e.message};V((e=>[...e,t]))})),t(this,"handleHandPosition",(e=>{Y((t=>({...t,...e.hand})))})),this.socket=e}}class Qe{constructor(e,s){t(this,"socket"),t(this,"controller",new Ye(this)),this.socket=new WebSocket(e),this.socket.onopen=e=>{s.onOpen&&s.onOpen(e),this.controller.onSocketOpen()},this.socket.onmessage=e=>{s.onMessage&&s.onMessage(e),this.controller.onSocketMessage(JSON.parse(e.data))},this.socket.onclose=e=>{s.onClose&&s.onClose(e),this.controller.onSocketClose()},this.socket.onerror=e=>{s.onError&&s.onError(e)}}emit(e){this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify(e))}close(){this.socket.close()}}const Ze=()=>{const[e,t]=s("Joining lobby..."),n=M().roomId.toUpperCase();W(n);const o=r();if(!U())return o("/"),null;return A(new Qe(ce,{onOpen:()=>{t(null)},onError:()=>{o("/"),A(null)}})),I((()=>{B().close(),A(null)})),h(H,{get fallback(){return h(pe,{message:"There was a problem loading the client..."})},get children(){const t=P((()=>!!e()),!0);return()=>t()?h(pe,{get message(){return e()}}):h(Ve,{})}})},et=()=>(a((()=>{U()&&R.set("username",U())})),h(T,{get children(){return h(E,{get children(){return[h(O,{path:"/",get element(){return h(ae,{})}}),h(O,{path:"/home",get element(){return h(ae,{})}}),h(O,{path:"/offline",get element(){return h(Xe,{})}}),h(O,{path:"/room/:roomId",get element(){return h(H,{get fallback(){return h(pe,{message:"Could not join room..."})},get children(){return h(Ze,{})}})}})]}})}}));J((()=>h(et,{})),document.getElementById("root"));
